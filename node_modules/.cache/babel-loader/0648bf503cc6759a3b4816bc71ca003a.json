{"ast":null,"code":"import { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nvar _jsxFileName = \"/Users/narendraomprakash/Desktop/Narendra/Semester-V-FALL2021/PDC/J-Component/Integrated-CryptRidez/src/Pages/Dashboard.js\";\nimport React, { Component } from 'react';\nimport Web3 from 'web3';\nimport * as util from \"ethereumjs-util\";\nimport '../App.css';\nimport user from '../abis/user.json';\nimport Main from '../Components/Main';\nimport User from '../Components/User';\n\nconst crypto = require('crypto');\n\nclass Dashboard extends Component {\n  async componentWillMount() {\n    await this.loadWeb3();\n    await this.loadBlockchainData();\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum);\n      await window.ethereum.enable();\n    } else if (window.web3) {\n      window.web3 = new Web3.providers.HttpProvider(\"127.0.0.1:9545\");\n    } else {\n      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!');\n    }\n  }\n\n  async loadBlockchainData() {\n    const web3 = window.web3; // Load account\n\n    const accounts = await web3.eth.getAccounts();\n    this.setState({\n      balance: balanceacc\n    });\n    const networkId = await web3.eth.net.getId();\n    const networkData = user.networks[networkId];\n    let reqCounts = 0,\n        imgCounts = 0,\n        rideCounts = 0;\n\n    if (networkData) {\n      const user1 = new web3.eth.Contract(user.abi, networkData.address);\n      this.setState({\n        user1\n      });\n      const reqCountsPromise = user1.methods.reqCount().call();\n      reqCountsPromise.then(reqCount => {\n        reqCounts = reqCount;\n      });\n      this.setState({\n        rideCounts\n      });\n      const imgCountsPromise = user1.methods.imgCount().call();\n      imgCountsPromise.then(imgCount => {\n        imgCounts = imgCount;\n      });\n      this.setState({\n        imgCounts\n      });\n      const rideCountsPromise = user1.methods.rideCount().call();\n      rideCountsPromise.then(rideCount => {\n        rideCounts = rideCount;\n      });\n      this.setState({\n        reqCounts\n      });\n\n      for (var i = 0; i <= reqCounts; i++) {\n        const users_var = await user1.methods.users(i).call();\n        this.setState({\n          users: [...this.state.users, users_var]\n        });\n      } //Load images\n\n\n      for (var j = 0; j <= imgCounts; j++) {\n        const img_var = await user1.methods.driver(1).call();\n        this.setState({\n          driver: [...this.state.driver, img_var]\n        });\n      }\n      /** */\n\n\n      for (var k = 0; k <= rideCounts; k++) {\n        const ride_var = await user1.methods.ride(k).call();\n        console.log(ride_var);\n        this.setState({\n          ride: [...this.state.ride, ride_var]\n        });\n      }\n\n      var message = crypto.randomBytes(20).toString('hex');\n      var hash = web3.utils.sha3(message);\n      const data = await web3.eth.personal.sign(hash, accounts[0]);\n      this.setState({\n        signature: data\n      });\n      this.setState({\n        message: message\n      });\n      var nonce = \"\\0x19Ethereum Signed Message:\\n\" + this.state.signature.length + this.state.signature;\n      nonce = util.keccak(Buffer.from(nonce, \"utf-8\"));\n      const {\n        v,\n        r,\n        s\n      } = util.fromRpcSig(this.state.signature);\n      const pubKey = util.ecrecover(util.toBuffer(nonce), v, r, s);\n      const addrBuf = util.pubToAddress(pubKey);\n      const addr = util.bufferToHex(addrBuf);\n      var message_hash = web3.utils.sha3(this.state.message);\n      var signing_address = await web3.eth.personal.ecRecover(message_hash, this.state.signature);\n      this.setState({\n        signing_address: signing_address\n      });\n      this.setState({\n        account: signing_address\n      });\n      var unitbal = await web3.eth.getBalance(this.state.account);\n      var balanceacc = await web3.utils.fromWei(unitbal, 'ether');\n      this.setState({\n        balance: balanceacc\n      });\n    } else {\n      window.alert('User contract not deployed to detected network.');\n    }\n  }\n\n  constructor(props) {\n    super(props);\n\n    this.rideReq = (source, destination, date, time) => {\n      this.setState({\n        loading: true\n      });\n      this.state.user1.methods.rideReq(source, destination, date, time).send({\n        from: this.state.account\n      }).on('transactionHash', hash => {\n        this.setState({\n          loading: false\n        });\n      });\n    };\n\n    this.uploadRide = (source, destination, date, time, rider, amount) => {\n      this.setState({\n        loading: true\n      });\n      this.state.user1.methods.uploadRide(source, destination, date, time, rider, amount).send({\n        from: this.state.account\n      }).on('transactionHash', hash => {\n        this.setState({\n          loading: false\n        });\n      });\n    };\n\n    this.tipImageOwner = (id, tipAmount) => {\n      this.setState({\n        loading: true\n      });\n      this.setState({\n        loading: false\n      });\n      this.state.cryptridez.methods.tipImageOwner(id).send({\n        from: this.state.account,\n        value: tipAmount\n      }).on('transactionHash', hash => {});\n    };\n\n    this.rideAmount = (id, amount) => {\n      this.state.user1.methods.ridePayment(id).send({\n        from: this.state.account,\n        value: amount\n      }).on('transactionHash', hash => {});\n    };\n\n    this.state = {\n      balance: '',\n      account: '',\n      user1: null,\n      users: [],\n      driver: [],\n      ride: [],\n      signature: '',\n      message: '',\n      signing_address: '',\n      loading: true,\n      email: '',\n      buffer: '',\n      img: []\n    }; // props.sendValuestoApp(this.state.signing_address,this.state.balance)\n  } // componentDidUpdate(prevProps)\n  // {\n  //   // console.log(prevProps)\n  // console.log(this.props.sendValuetoApp())\n  // }\n  // props.sendValuestoApp()\n\n\n  render() {\n    var _this$state, _this$state2;\n\n    let body;\n    const authorizedAccounts = ['0x50Fe6C433c41595396044A9bcdF9500963D4e236'.toLowerCase(), '0x3d876A0BfFBCd490a6D23202ac2b5D66A26942A1'.toLowerCase()];\n    const authorizedAccounts2 = ['0x2fb5eBC35A6d6e7c26bEC01122b34d84D7727aD9'.toLowerCase()];\n    var email = sessionStorage.getItem('login');\n    var domain = email.substring(email.lastIndexOf(\"@\") + 1);\n\n    if (authorizedAccounts.includes(this.state.signing_address) && domain === \"drivercryptridez.com\") {\n      body = /*#__PURE__*/_jsxDEV(Main, {\n        account: this.state.signing_address,\n        users: this.state.users,\n        driver: this.state.driver,\n        captureFile: this.captureFile,\n        uploadImage: this.uploadImage,\n        uploadRide: this.uploadRide\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 222,\n        columnNumber: 11\n      }, this);\n    } else {\n      body = /*#__PURE__*/_jsxDEV(User, {\n        account: this.state.signing_address,\n        rideReq: this.rideReq,\n        users: this.state.users,\n        uploadRide: this.uploadRide,\n        ride: this.state.ride,\n        rideAmount: this.rideAmount\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 233,\n        columnNumber: 11\n      }, this);\n    }\n\n    this.props.sendValuestoApp((_this$state = this.state) === null || _this$state === void 0 ? void 0 : _this$state.signing_address, (_this$state2 = this.state) === null || _this$state2 === void 0 ? void 0 : _this$state2.balance);\n    return /*#__PURE__*/_jsxDEV(\"div\", {\n      children: body\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 246,\n      columnNumber: 7\n    }, this);\n  }\n\n}\n\nexport default Dashboard;","map":{"version":3,"sources":["/Users/narendraomprakash/Desktop/Narendra/Semester-V-FALL2021/PDC/J-Component/Integrated-CryptRidez/src/Pages/Dashboard.js"],"names":["React","Component","Web3","util","user","Main","User","crypto","require","Dashboard","componentWillMount","loadWeb3","loadBlockchainData","window","ethereum","web3","enable","providers","HttpProvider","alert","accounts","eth","getAccounts","setState","balance","balanceacc","networkId","net","getId","networkData","networks","reqCounts","imgCounts","rideCounts","user1","Contract","abi","address","reqCountsPromise","methods","reqCount","call","then","imgCountsPromise","imgCount","rideCountsPromise","rideCount","i","users_var","users","state","j","img_var","driver","k","ride_var","ride","console","log","message","randomBytes","toString","hash","utils","sha3","data","personal","sign","signature","nonce","length","keccak","Buffer","from","v","r","s","fromRpcSig","pubKey","ecrecover","toBuffer","addrBuf","pubToAddress","addr","bufferToHex","message_hash","signing_address","ecRecover","account","unitbal","getBalance","fromWei","constructor","props","rideReq","source","destination","date","time","loading","send","on","uploadRide","rider","amount","tipImageOwner","id","tipAmount","cryptridez","value","rideAmount","ridePayment","email","buffer","img","render","body","authorizedAccounts","toLowerCase","authorizedAccounts2","sessionStorage","getItem","domain","substring","lastIndexOf","includes","captureFile","uploadImage","sendValuestoApp"],"mappings":"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","sourcesContent":["import React, { Component } from 'react';\nimport Web3 from 'web3';\nimport * as util from \"ethereumjs-util\";\nimport '../App.css';\nimport user from '../abis/user.json'\nimport Main from '../Components/Main'\n\nimport User from '../Components/User'\nconst crypto=require('crypto')\n\nclass Dashboard extends Component {\n  async componentWillMount() {\n    await this.loadWeb3()\n    await this.loadBlockchainData()\n  }\n\n  async loadWeb3() {\n    if (window.ethereum) {\n      window.web3 = new Web3(window.ethereum)\n      await window.ethereum.enable()\n    }\n    else if (window.web3) {\n      window.web3 = new Web3.providers.HttpProvider(\"127.0.0.1:9545\")\n    }\n    else {\n      window.alert('Non-Ethereum browser detected. You should consider trying MetaMask!')\n    }\n  }\n\n  async loadBlockchainData() {\n    const web3 = window.web3\n    // Load account\n    const accounts = await web3.eth.getAccounts()\n    \n    \n\n    this.setState({balance: balanceacc})\n\n    const networkId = await web3.eth.net.getId()\n    const networkData = user.networks[networkId]\n    let reqCounts=0,imgCounts=0,rideCounts=0;\n\n    if (networkData) {\n      const user1 = new web3.eth.Contract(user.abi, networkData.address)\n\n      this.setState({ user1 })\n\n\n      const reqCountsPromise =  user1.methods.reqCount().call()\n\n      \n      reqCountsPromise.then((reqCount) => {\n        reqCounts=reqCount\n      })\n\n      this.setState({ rideCounts })\n\n      \n      const imgCountsPromise =  user1.methods.imgCount().call()\n\n      \n      imgCountsPromise.then((imgCount) => {\n        imgCounts=imgCount\n      }\n\n      )\n\n      this.setState({ imgCounts })\n\n     \n      const rideCountsPromise =  user1.methods.rideCount().call()\n\n      rideCountsPromise.then((rideCount) => {\n        rideCounts=rideCount\n      })\n\n\n      this.setState({ reqCounts })\n     \n      for (var i = 0; i <= reqCounts; i++) {\n        const users_var = await user1.methods.users(i).call()\n\n        this.setState({\n          users: [...this.state.users,users_var]\n        })\n      }\n\n      //Load images\n      \n      for (var j=0; j<=imgCounts; j++){\n        const img_var = await user1.methods.driver(1).call()\n\n        \n        this.setState({\n          driver: [...this.state.driver,img_var]\n        })\n      }\n     /** */\n\n     for (var k=0; k<=rideCounts; k++){\n      const ride_var = await user1.methods.ride(k).call()\n      console.log(ride_var);\n\n      this.setState({\n        ride: [...this.state.ride,ride_var]\n      })\n\n      \n    }\n\n\n    var message = crypto.randomBytes(20).toString('hex');\n    var hash = web3.utils.sha3(message)\n    const data=await web3.eth.personal.sign(hash, accounts[0])\n    this.setState({\n      signature: data\n    })\n      this.setState({\n        message: message\n      })\n    var nonce = \"\\0x19Ethereum Signed Message:\\n\" + this.state.signature.length + this.state.signature\n    nonce = util.keccak(Buffer.from(nonce, \"utf-8\"))\n    const { v, r, s } = util.fromRpcSig(this.state.signature)\n    const pubKey = util.ecrecover(util.toBuffer(nonce), v, r, s)\n    const addrBuf = util.pubToAddress(pubKey)\n    const addr = util.bufferToHex(addrBuf)\n\n    var message_hash=web3.utils.sha3(this.state.message)\n\n    var signing_address = await web3.eth.personal.ecRecover(message_hash,this.state.signature)\n\n    this.setState({\n      signing_address: signing_address\n    })\n   \n    this.setState({ account: signing_address })\n    var unitbal = await web3.eth.getBalance(this.state.account)\n    var balanceacc = await web3.utils.fromWei(unitbal,'ether')\n\n    this.setState({balance: balanceacc})\n\n\n    } else {\n      window.alert('User contract not deployed to detected network.')\n    }\n\n  }  \n\n  rideReq = (source,destination,date,time) => {\n    this.setState({loading:true })\n      this.state.user1.methods.rideReq(source,destination,date,time).send({from: this.state.account}).on('transactionHash', (hash) => {\n        this.setState({ loading: false })\n      })\n  }\n\n  uploadRide = (source,destination,date,time,rider,amount) => {\n    this.setState({loading:true })\n      this.state.user1.methods.uploadRide(source,destination,date,time,rider,amount).send({from: this.state.account}).on('transactionHash', (hash) => {\n        this.setState({ loading: false })\n      })\n  }\n\n  \n  tipImageOwner = (id, tipAmount) =>{\n    this.setState({ loading: true })\n    this.setState({ loading: false })\n    this.state.cryptridez.methods.tipImageOwner(id).send({ from: this.state.account, value: tipAmount }).on('transactionHash', (hash) => {\n    })\n  }\n\n  rideAmount = (id,amount) =>{\n    this.state.user1.methods.ridePayment(id).send({ from: this.state.account, value: amount }).on('transactionHash', (hash) => {\n    })\n  }\n\n  \n  \n  constructor(props) {\n    super(props)\n    this.state = {\n      balance:'',\n      account: '',\n      user1: null,\n      users:[],\n      driver:[],\n      ride:[],\n      signature:'',\n      message:'',\n      signing_address:'',\n      loading: true,\n      email:'',\n      buffer:'',\n      \n      img:[]\n    }\n    // props.sendValuestoApp(this.state.signing_address,this.state.balance)\n\n  }\n\n  // componentDidUpdate(prevProps)\n  // {\n  //   // console.log(prevProps)\n    // console.log(this.props.sendValuetoApp())\n  // }\n  \n  // props.sendValuestoApp()\n\n  render() {\n\n    let body\n    \n    const authorizedAccounts = ['0x50Fe6C433c41595396044A9bcdF9500963D4e236'.toLowerCase(),'0x3d876A0BfFBCd490a6D23202ac2b5D66A26942A1'.toLowerCase()]\n    const authorizedAccounts2 = ['0x2fb5eBC35A6d6e7c26bEC01122b34d84D7727aD9'.toLowerCase()]\n\n    var email=sessionStorage.getItem('login')\n    var domain = email.substring(email.lastIndexOf(\"@\")+1);\n   \n\n        if(authorizedAccounts.includes(this.state.signing_address) && domain===\"drivercryptridez.com\"){\n          \n          body = \n          <Main\n          account={this.state.signing_address}\n          users={this.state.users}\n          driver={this.state.driver}\n          captureFile={this.captureFile}\n          uploadImage={this.uploadImage}\n          uploadRide = {this.uploadRide}\n        />\n        }\n        else{\n          body = \n          <User\n          account = {this.state.signing_address}\n          rideReq = {this.rideReq} \n          users={this.state.users}\n          uploadRide = {this.uploadRide}\n          ride = {this.state.ride}\n          rideAmount = {this.rideAmount}\n          />\n                  }\n\n                  this.props.sendValuestoApp(this.state?.signing_address,this.state?.balance)\n\n    return (\n      <div>\n   \n        { body }\n\n      </div>\n    );\n  }\n}\n\nexport default Dashboard;"]},"metadata":{},"sourceType":"module"}